
<head><style>
    body        { background: #fff; margin-left:  40px;   font-size:  0.9em;  font-family: sans-serif; max-width: 800px; }
    h1          { background: #ffb; margin-left: -30px;   border-top:    5px  solid #ccc; }
    h2          { background: #ffb; margin-left: -20px;   border-top:    3px  solid #ddd; }
    h3          { background: #ffb; margin-left: -10px; }
    h4          { background: #ffb; }
    code        { font-size:    1.1em;  background:  #ddf; }
    pre         { margin-left:  2em;    background:  #ddf; }
    pre code    { font-size:    1.1em;  background:  #ddf; }
</style></head>

<p style="text-align:center">
    <a href="master-toc.html">master TOC</a>
|
    <a href="index.html">main page</a>
|
    <a href="index.html#license">license</a>
</p>
<h2><a name="g2migr"></a> migrating from g2</h2>

<p><font color="red"></p>

<p><strong>This document is a <em>MUST</em> read if you are currently using g2 and want to
move to g3.</strong></p>

<p></font></p>

<p>First things first: g2 will be supported for a good long time.  My current
<em>expert</em> users do not cause me any load anyway.</p>

<p>Migration should be straightforward, but it is not automatic.  You should run
the "check-g2-compat" program first, to see any <em>major</em> differences that
affect you.  The bulk of the changes are in the RC file, which must be
manually handled (links below).  The conf files have very few changes -- they
apply only if you use "NAME/" or delegation.</p>

<p>You must first read about <a href="g2incompat.html">incompatible</a> features and
<a href="g2dropped.html">dropped</a> features.  Some features have been replaced with
<a href="g2alt.html">alternatives</a>.</p>

<p>Since the majority of changes are in the rc file, they're all listed
<a href="g2rcdiff.html">here</a>.</p>

<p>The rest of this page describes the completely standalone "check-g2-compat"
script that you can find in the repo root (i.e., not in "src/").</p>

<h3>the "check-g2-compat" program</h3>

<p>This program checks a few things only, not everything.  In particular, it
looks for settings and status that might:</p>

<ul>
<li>make g3 unusable for lots of users</li>
<li>make g3 give <em>more</em> access than g2 under some conditions.</li>
</ul>

<p>It does NOT look for or warn about anything else; you're expected to read (and
act upon, if needed) the rest of the migration guide links given a few paras
above to cover everything else.</p>

<p>Here's an explanation of those messages that the check-g2-compat program may
put that contain the words "see docs":</p>

<ul>
<li><p><code>GL_ADMINDIR in the wrong place -- aborting</code></p>

<p>It expects to find <code>GL_ADMINDIR</code> and <code>REPO_BASE</code> pointing to the right
places.  It aborts if these conditions are not met and does not scan
further since that sort of guesswork is not good.  If you are in that
position, make a symlink from the real location to the expected location,
change the RC accordingly, and re-try.</p></li>
<li><p><code>REPO_BASE in the wrong place -- aborting</code></p>

<p>same as above</p></li>
<li><p><code>fallthru in NAME rules</code></p>

<p><strong>This is a significant difference and affects access badly (gives access
that would otherwise not be given)</strong>.  Please see the <a href="g2incompat.html">list of non-RC
incompatibilities</a>.</p></li>
<li><p><code>subconf command in admin repo</code></p>

<p>This is not so bad security wise but it might <em>reduce</em> access by not
processing files you intended to.  Again, see the same link as in the
previous bullet.</p></li>
<li><p><code>found N gl-creater files</code></p>

<p>These need to be renamed to <code>gl-creator</code> (the correct spelling at last,
hooray!).  Suggested command sequence:</p>

<pre><code>cd $HOME/repositories
find . -type d -name "*.git" -prune | while read r
do
    mv $r/gl-creater $r/gl-creator
done 2&gt;/dev/null
</code></pre>

<p>Once you do this, the g2 will not work completely unless you change them
back.</p></li>
<li><p><code>found N gl-perms files with R or RW</code></p>

<p>Setting perms of R and RW will no longer work; you have to say READERS and
WRITERS now.  Suggested command:</p></li>
</ul>

<p>The following variables need to be <a href="g2rcdiff.html#rc-preset">preset</a> in the rc file
<strong>before</strong> running <code>gitolite setup</code>.  Otherwise the default actions will
clobber something and require some recovery.</p>

<ul>
<li><p><code>GL_NO_SETUP_AUTHKEYS</code> (default will clobber your authkeys file)</p></li>
<li><p><code>GL_NO_DAEMON_NO_GITWEB</code> (default will clobber your projects.list file and
git-daemon-export-ok files)</p></li>
<li><p><code>UPDATE_CHAINS_TO</code> (default will fail to run this extra check when users
push)</p></li>
<li><p><code>ADMIN_POST_UPDATE_CHAINS_TO</code> (severity depends on what your code is
doing; see <a href="g2rcdiff.html">g2rcdiff</a> for how to fix this)</p></li>
<li><p><code>GL_ALL_INCLUDES_SPECIAL</code> (default will allow gitweb and daemon to be able
to read any repos that have <code>R = @all</code>)</p></li>
<li><p><code>GIT_PATH</code> (presumably your git is in some non-std path so unless you
preset <code>$ENV{PATH}</code> per instructions in the <a href="g2rcdiff.html">rc file
differences</a> doc, nothing will work).</p></li>
</ul>
